# Маршрутизация

Пользователь своими действиями по представлениям приложения совершает переходы на различные страницы сайта (отправляет get запросы на получение данных), создаёт новые данные, такие как курсы или персональный профиль (отправляет данные с запросом post), редактирует или удаляет данные (отправляет метод запроса `delete`). При каждом перенаправлении по соответствующму маршруту контроллеры и промежуточные обработчики предоставляет опредёленный функционал. 

⬅️ **Подробную информацию обо всех контроллерах смотрите в разделе [Контроллеры](routes.md)** <br/>
⬅️ **Подробную информацию обо всех представлениях смотрите в разделе [Представления](views.md)** <br/>
⬅️ **Подробную информацию обо всех промежуточные обработчики смотрите в разделе [Промежуточные обработчики](routes.md)** <br/>
↩️ [К оглавлению документации](../README.md) <br/> 

## Оглавление раздела
- [Маршрутизация](#маршрутизация)
  - [Оглавление раздела](#оглавление-раздела)
  - [Описание маршрутов](#описание-маршрутов)
  - [Реализация маршрутов](#реализация-маршрутов)

---

## Описание маршрутов

Маршрутизатор каждой страницы - это отдельный экземпляр объекта `Router`, который отвечает за маршруты касающиеся отдельной страницы. Перечень всех запросов приложения указан в таблице "Запросы всех страниц приложения" <br/>

*Таблица всех страниц приложения* <br/>
|Название страницы| Метод запроса |    URL-путь запроса     |       middleware       |                                     Краткое описание                                     |
| :-------------: | :---------: | :---------------------: | :--------------------: | :--------------------------------------------------------------------------------------: |
|     Главная     |     get     |           "/"           |           -            |                               Получение страницы "Главная"                               |
|      Курсы      |     get     |        "/courses"       |           -            |               Получение страницы "Курсы" и получение всех курсов магазина                |
|      Курсы      |     get     |      "/courses/:id"     |           -            |                            Получение одного курса из магазина                            |
|      Курсы      |     get     |   "/courses/:id/edit"   |          auth          |                     Получение страницы "Редактирование одного курса"                     |
|      Курсы      |     post    |     "/courses/edit"     | auth, courseValidators |                       Отправка редактируемых данных старого курса                        |
|      Курсы      |     post    |    "/courses/remove"    |          auth          |                              Удаление существующего курса                                |
|  Добавить курс  |     get     |         "/add"          |          auth          |                            Получение страницы "Добавить курс"                            |
|  Добавить курс  |     post    |         "/add"          | auth, courseValidators |   Отправка и сохранение одного курса и последующего перенаправления на страницу курсов   |
|     Профиль     |     get     |       "/profile"        |          auth          |                          Получение страницы профиля пользователя                         |
|     Профиль     |     post    |       "/profile"        |          auth          |                    Отправка редактируемых данных профиля пользователя                    |
|     Корзина     |     get     |         "/card"         |          auth          |                       Получение страницы "Корзина" и всех товаров                        |
|     Корзина     |     post    |       "/card/add"       |          auth          |       Добавление товара в "Корзину" c помощью клавиши "Купить" на странице "Курсы"       |
|     Корзина     |    delete   |    "/card/remove/:id"   |          auth          |                                   Удаление одного курса                                  |
|     Заказы      |     get     |        "/orders"        |          auth          |                               Получение страницы "Заказы"                                |
|     Заказы      |     post    |        "/orders"        |          auth          | Отправка данных на страницу "Заказы" через клавишу "Сделать заказ" на странице "Корзина" |
|   Вход / выход  |     get     |       "/auth/login"     |           -            |                   Отправка данных пользователя для входа в приложение                    |
|   Вход / выход  |     get     |       "/auth/loguot"    |           -            |                    Выход из приложения и закрытия сессии пользователя                    |
|   Вход / выход  |     get     |       "/auth/reset"     |           -            |                         Получение страницы восстановление пароля                         |
|   Вход / выход  |     get     | "/auth/password/:token" |           -            |                         Получение токена на восстановление пароля                        |
|   Вход / выход  |     post    |       "/auth/login"     |           -            |                   Отправка данных пользователя для входа в приложение                    |
|   Вход / выход  |     post    |      "/auth/register"   |   registerValidators   |           Отправка регистрационных данных для получения доступа в приложение             |
|   Вход / выход  |     post    |       "/auth/reset"     |           -            |       Отправка ранее регистрируемой почты для восстановления доступа в приложение        |
|   Вход / выход  |     post    |     "/auth/password"    |           -            |                   Отправка пароля пользователя для доступа в приложение                  |

---

## Реализация маршрутов

Маршрутизаторы являют собой однотипные функции, которые отличаются только маршрутом и типом запроса, поэтому нет смысла создавать описание для машрутизатора каждой страницы приложения. Разберём пример маршрутизаторов страницы "Курсы", поскольку они пересекают все примеры маршрутов приложения. <br/>

Создаём и экспортируем новый экземпляр объекта `Router`: <br/>
```node
const {Router} = require('express')
const router = Router()
...
module.exports = router
```

Создаём маршруты с помощью функции `router`. Необходимо заметить, что `router` представляет из себя такого рода функцию - `router.method(route, [...callback], callback)`, где: <br/>
- `method` - обязательный параметр. Метод запроса, например `get` или `post`. <br/>
- `route` - обязательный параметр. Путь маршрута, например `/home` или `/category/computers/apple`. <br/>
- `[...callback]` - необязательный параметр. Массив промежуточных обработчиков. <br/>
- `callback` - обязательный параметр. Функция, определяющая логику кода. <br/>

Определяем несколько маршрутов и типов запроса страницы "Курсы": <br/>
```node
...
router.get('/', async (req, res) => {})
...
router.post('/edit', auth, courseValidators, async (req, res) => {})
...
```
Где: <br/>
- `router.get('/', async (req, res) => {})` - метод запроса `get` объекта `router`, который принимает 2 аргумента: <br/>
  - `'/'` - обязательный параметр, который определяет маршрут запроса. <br/>
  - `async (req, res) => {}` - обязательный параметр, callback функция, определяющая контроллер. Подробнее о контроллерах смотрите раздел [Контроллеры](controllers.md#контроллеры). <br/>
- `router.post('/edit', auth, courseValidators, async (req, res) => {})` - метод запроса `post` объекта `router`, который принимает 3 аргумента:<br/>
  - `'/edit'` - обязательный параметр, который определяет маршрут запроса. <br/>
  - `auth` - необязательный параметр. Промежуточный обработчик, проверяющий права пользователя на редактирование курса. Подробнее о контроллере `auth` смотрите подраздел [Промежуточный обработчик `auth`](). <br/>
  - `courseValidators` - необязательный параметр. Промежуточный обработчик, валидирующий вводимые данные редактируемого курса пользователям. Подробнее о контроллере `courseValidators` смотрите подраздел [Промежуточный обработчик `courseValidators`](). <br/>
  - `async (req, res) => {}` - обязательный параметр, callback функция, определяющая контроллер. Подробнее о контроллерах смотрите раздел [Контроллеры](controllers.md#контроллеры). <br/>

Подключаем экспортируемый машрутизатор `router` в главный файл `index.js`: <br/>

```node
...
const coursesRoutes = require('./routes/courses')
app.use('/courses', coursesRoutes)
...
```
Где: <br/>
- `const coursesRoutes = require('./routes/courses')` - присваем машрутизатору `router` страницы "Курсы" переменной `coursesRoutes`. <br/>
- `app.use('/courses', coursesRoutes)` - метод `use` объекта `app` принимает 2 аргумента: <br/>
  - `'/courses'` - обязательный параметр. Корневой маршрут. <br/>
  - `coursesRoutes` - обязательный параметр. Маршрутизатор `router`. <br/>

⬆️ [К оглавлению раздела "Маршрутизация"](#оглавление-раздела) <br/>
↩️ [К оглавлению документации](../README.md) <br/>


